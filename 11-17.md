---
title: hadoop面试会问
date: 11/17/2022 7:47:10 PM  
categories: 日志
comments: "true"
---

# hdfs的写流程 #
- 面试|必备
- 通过客户端，写文件
- 首先客户端会调用 FileSystem 的creat
- 去和namenode进行通信 ， 是通过rpc通信
- 然后namenode会去检查这个路径的文件是不是存在并且检查你的权限
- 假如都ok ， 则执行你的操作
- 但是这个时候还没有写数据
- 是不关联任何block的
- 而namenode根据上传文件的大小，和块的大小，以及副本数
- 计算要上传多少块以及后续要在datanode上的什么位置
- 最后把信息返回到客户端
- 就是 ： fsdataoutputstream
- Client 调用 fdsdataoutputstream
- 将第一个块的第一个副本数写第一个dn节点
- 写完去写第二个
- 然后是第三个
- 当三个都写完了 ， 会返回一个ack package
- 把确认包给dn2
- 当dn2确认并加上自己的
- 然后给dn3，同上
- 最后将ack package 返回给 fdsdataoutputstream
- 上面只是对于第一个块
- 当所有的块全部写完的时候，我们会调用
- 这个流对象的close方法
- 告诉namenode ，文件写入成功
# hdfs读操作 #
- 面试|必备
- Cilent调用FS.open(filepath)
- nn和pc进行通信，返回该文件的部分或者全部的block列表
- 以fdsdatainputstream的形式
- Client的FSDDataInputstream的read方法
- 会去和最近的dn进行匹配，读取完成
- 会check，假如ok，就关闭通信
- 假如读取失败
- 会记录dn+block信息
- 下次就也不会从这个节点读取，转而从其他的节点读取
- 然后会去和第二块的最近的dn进行读取，以此类推
- 当整个block全部读取完之后，文件还没读取完，就会继续调用fs的方法进行下一次block的读取
- 以此类推
- 最后用close方法关闭

# hdfs的副本放置策略 #
- 机架
- 生产上读写操作，选择dn节点进行读取
- 第一副本 ： 
- 放置在client上传的dn节点
- client 不在dn节点 ，就随机选择一个dn
- 第二副本 ： 
- 放置在第一个副本不同的机架上的一个dn节点
- 第三副本 ： 
- 和第二副本相同机架但是不同节点
- 补充 ；
- 副本数是三
- 上述都是以副本数为3的情况
- 如果是4就多几个随机

# hdfs的安全模式 #
- 什么时候会发生安全模式
- 刚启动hadoop的时候
- hsdf发生故障的时候 ： 集群文件大量会丢失
- 人为进入
- 命令 ： `hdfs dfsadmin -safemode <enter | leave | get | wait | forceExit>`

# 补充 #
- kill 命令 不只有一个-9
- 还有很多 ： 目前我所看见的至少有64个

```


	1) SIGHUP     2) SIGINT     3) SIGQUIT     4) SIGILL     5) SIGTRAP
	6) SIGABRT     7) SIGBUS     8) SIGFPE     9) SIGKILL    10) SIGUSR1
	11) SIGSEGV    12) SIGUSR2    13) SIGPIPE    14) SIGALRM    15) SIGTERM
	16) SIGSTKFLT    17) SIGCHLD    18) SIGCONT    19) SIGSTOP    20) SIGTSTP
	21) SIGTTIN    22) SIGTTOU    23) SIGURG    24) SIGXCPU    25) SIGXFSZ
	26) SIGVTALRM    27) SIGPROF    28) SIGWINCH    29) SIGIO    30) SIGPWR
	31) SIGSYS    34) SIGRTMIN    35) SIGRTMIN+1    36) SIGRTMIN+2    37) SIGRTMIN+3
	38) SIGRTMIN+4    39) SIGRTMIN+5    40) SIGRTMIN+6    41) SIGRTMIN+7    42) SIGRTMIN+8
	43) SIGRTMIN+9    44) SIGRTMIN+10    45) SIGRTMIN+11    46) SIGRTMIN+12    47) SIGRTMIN+13
	48) SIGRTMIN+14    49) SIGRTMIN+15    50) SIGRTMAX-14    51) SIGRTMAX-13    52) SIGRTMAX-12
	53) SIGRTMAX-11    54) SIGRTMAX-10    55) SIGRTMAX-9    56) SIGRTMAX-8    57) SIGRTMAX-7
	58) SIGRTMAX-6    59) SIGRTMAX-5    60) SIGRTMAX-4    61) SIGRTMAX-3    62) SIGRTMAX-2
	63) SIGRTMAX-1    64) SIGRTMAX

```

- 这个简单介绍几个 ： 
- 1 ： 重新加载合格进程
- 9 ： 杀死一个进程
- 15 ： 正常停止一个进程

# 公司内部的逻辑 #
- 一般一个组件都会有一个用户进行管理
- 比如 ： mysql ： 可以创建一个mysql用户
- 等
- 创建数据库的流程 ： 
- `create dataase dl2262;`
- `grant all priviledges on dl2262 identified by "1234546;"`
- `flush priviledges;` 

# hdfs生产最佳实践 #
- 如何查看hdfs的文件块是不是丢失
-`hdfs fsck<path>`
## hdfs 的block块丢失了如何解决 ##
- 第一种 ： 不用解决 ，也因为hdfs会自动回复，一般是6h ， 就是dn上传的时候
- 第二种 ： 手动进行回复
- `hdfs debug recoverLease -path <filename> retries num` 
- 后面的是重试次数

