---
title: mysql
date: 11/3/2022 9:11:14 AM 
categories: 日志
comments: "true"
tag: mysql
---
# 简介

- 关系型数据库
- 非关系型数据库 ： nosql
- 存储方式 ， 类似excel
- 学习 ： 基于官网
- 版本 ：
- 5.7 ：主流
- 5.6 ：也有
- 8.x ：不是主流 ： java团队
- 极限是在几tb级别 秒级别 毫秒级别 添加索引还可以更快

# 下载安装包

- 5.7
- 安装包种类
- rpm ： 不可以完成二次开发，只能用mysql官网的
- tar ： 相当于自己魔改的有很多官方没有的功能
- rpm ； 要注意el7的 是centos7的
- 用lazz
- 上传 ：rz
- 下载 ：sz

## mysql的卸载

- 在windows下 ， mysql 是先在控制面板里卸载，
- 然后把安装目录卸载掉
- 在c盘的 ProgramData 里也有文件残留，不过是隐藏文件要自己打开的
- 然后删除注册表上的
- linux
- 先停掉mysql
- 然后通过rpm - qa | grep mysql | xargs -n1 rpm -e --nodeps
- 然后找到mysql生成的文件
- find / -name `"*mysql*"`
- 把该删的文件全部删掉
- 然后重新安装

## mysql的安装linux版本

- 这里安装的是mysql的tar包
- 首先要解压  :  通过 `tar -vxf xxxxxxxxxx`
- 一般安装mysql的软件的时候要卸载一个东西 ，就是 `mariadb-libs-5.5.56-2.el7.x86_64`
- 通过 `rpm -e --nodeps mariadb-libs-5.5.56-2.el7.x86_64`
- 就卸载了
- 然后再进行安装
- 我是创建了一个sh脚本

```

rpm -ivh mysql-community-common-5.7.28-1.el7.x86_64.rpm
rpm -ivh mysql-community-libs-5.7.28-1.el7.x86_64.rpm
rpm -ivh mysql-community-libs-compat-5.7.28-1.el7.x86_64.rpm
rpm -ivh mysql-community-client-5.7.28-1.el7.x86_64.rpm
rpm -ivh mysql-community-server-5.7.28-1.el7.x86_64.rpm

```

然后运行脚本

- 安装成功了之后，我们初始化mysql
- mysqld initialize user=mysql
- 然后启动mysql
- systemctl start mysql
- 然后查看/var/log/mysql.log
- 就可以查看到我们的初始密码
- 然后通过
- mysql -uroot -pxxx
- 就可以进行登录
- 而如果有敏感字符，则要用转义字符的方式比如 \/ : 代表一个 /
- 然后再进行设置密码
- `set password = password("xxxxxxxx")
- 再通过flush privileges 进行更改

# mysql的操作

- show databases;
- 展示数据库
- 展示的数据库的软件 ：
- navcat
- sqlyog
- dbvear
- 但是当他是 `root@localhost`的时候，我们只能通过本机访问
- 但是可以改成 ：` root@%: xxxx(密码)`
- 就可以通过任意机器访问
- 通过use xxx更改到xxx数据库
- 通过show tables 查看表
- 选择字段 ： select xxx form xxx表 比如 ： `select host,user from user;`
- 修改表中数据 ： update 比如 ： `update mysql.user set host="%" where user="root";`
- 而后通过 ： `flash privileges` 进行权限修改
- 然后再自己的wins上通过远程访问的软件访问他
- 语法 ：
- sql语法 ：
- ddl ： 数据定义语言
- dml ： 数据操作语言
- dcl ： 数据控制语言
- 都不区分大小写
- 'null' ： 字符串字段
- '' ： 同上
- NULL ： 空
- 上述三个是不一样的意义
- 字符集 ： 5.7 默认的字符集是拉丁的
- 我们可以在创建表的时候更改字符集
- 

```

		CREATE TABLE `name` (
		  `id` int(3) DEFAULT NULL,
		  `age` int(3) DEFAULT NULL,
		  `name` varchar(3) DEFAULT NULL
		) ENGINE=InnoDB DEFAULT CHARSET=UTF-8 // 字符集

```

- 它支持嵌套

```

		select name ,age_max ,age_avg 
		from(
		select 
		name,
		max(age) as age_max,
		min(age) as age_min,
		count(age) as age_count,
		avg(age) as age_avg
		from xxx
		group by name) as res 
		where age_avg >18;

```

## 其他操作

### where

- 过滤条件
- `>`
- `<`
- `=`
- `>=`
- `<=`
- `<>` (也可以是 `!=`)
- `and` `or` `in` `notin`
- 根据本意就好 下面的一行代表复合查询
- `select * from xx where name in ('要查询的东西' ， '要查询的东西' ，..);`
- `not in` 同上
- `between and` : 代表在。。。之间的
- 

### like

- like rlike regexp ： 模糊匹配
- ` select * from where name like "z%"` : 代表查找第一个是z的
- 占位符 ： _ : 占位一个
- ` select * from where name like "_s%"` :第二个是s的

### 合并表

- 合并成一个纵向的表
- `union` ： 去重
- `union all` ： 不去重

### 查询限制

- limit
- `select * from xxx limit 2`
- 代表只显示两条
- 但是底层已经查完了
- 只是只显示两条

## 数据清洗

- 清除有无用的数据
- 就是null的
- 工作中一般不会删除数据 ，就是单纯的过滤数据 ，也不让更改数据
- 一般用 is null 或者 is not null
- 要把null输出0，并显示
- 处理空值的函数
- ifnull(xxx,xxx,...)
- coalesce(xxx ,xxx ,xxxx...)
- 他们都是如果里面的值是空那么就会验证下一个数值，如果不为空就输出 ，为空 就继续往下

```
select 
name
id
clalesce(age, 0) as age_alias
...
from xxx
```

## ddl

- creat drop alter show（？）
- 
- 创建数据库

```


		creat {DATABASE | SCHEMA} [IF NOT ExISTS] db_name
		[creat_option]
		creat_option : {CHARACT}
		create table name (create_definition)
		例子 ：
	 

		create table try (
		id int(3) not null auto_increment,
		name varchar(3) comment '名字注释',
		age int(3),
		create_user varchar(5),
		create_time timestamp not null default  current_timestamp,
		update_time timestamp not null default current_timestamp on update current_timestamp,--更新显示时间
		primary key(id)--主键
		);
```

- 表名字 一定是英文 ， 不要写中文 ，可以汉语拼音
- 一般公司有建表风格
- 可以加注释 ： comment
- 空格不宜过多，最好全部贴着最前面
- 注意括号不能是中文版的

### 聚合函数

- 把多行数据聚合成一行 ：
- sum
- max
- min
- avg
- count

```
select
sum(age) as age,
max(age) as age,
min(age) as age,
count(age) as age,
avg(age) as age 
from xxx 

```

### 分组函数

- group by colum
- `select * from xxx group by age;`
- `select * from xxx where id > 1 having group by age;`
- 如果group by 两个 则他的维度就变了
- 就会变得更细
- 而且针对于分组之后的结果进行过滤 ，要用having
- `select * from xxx group by age having id > 1;`
- group by 之后你不可以用where

### join

- 多表联查
- join
- 内连接 ： 他们的公共的部分 ` select * from a （inner） join b on a.id=b.id`
- 外连接 ：
- 左连接 ：以左表为主 ，右表来匹配 匹配的上 就是可以 匹配不上就是null ` select * from a left join b on a.id=b.id`
- 右连接 ：以右表为主 ， 同上 ： `select * from a right join b on a.id=b.id`
- 全连接 ： 左右表数据都是全的 ： `select * from a Full join b on a.id=b.id` 无重复的 （mysql里不支持全连接）

### show

```

		show {databases | schemas}
		[LIKE 'pattern' | WHERE expr]

		show [FULL] tables : 不一定是要切换到这个数据库下才可以
		[{FROM | IN} db_name]
		[{LIKE 'pattern' | WHERE expr}]
```

### use

- use xxx数据库

### drop

- drop tablename

## dml

```

		insert select update delete
		insert[LOW_PRIORITY | DELAYED | HIGH_PRORITY] [IGNORE]
		[INTO]
		[(col_name[,col_name]...)]
		{VALUES | VALUE} (value_list) [, (value_list)] ...
		[ON DUPLICATE KEY UPDATE assignment_list]
		比如 ：INSERT into user_table (name,age)VALUES ('zs',10) , ('ad' ,19);
		* 表示所有字段
		select *
		from user_table;
		select name,age from user_table;

```

### desc

- 描述这个表的字段（列）

### update

- update [low_priority] [ignore] table_reference
- set assignment_list
- [where where_condition]
- [order by ..]
- [limit row_count]
- `update user_info set age=30; // 这个是对整个表进行更改`
- `update user_info set age=30 where id=1; // 这个是对id=1的一列进行更改`

### delete

- 删除数据
- delete [low_priority] [quick] [ignore] from tablename
- [partition(partition_name [, partition_name ...])]
- [where where_condition]
- [order by ..]
- [limit row_count]
- `delete from user_info where id=1; // 删除id=1的那个行 `
- `delete from user_info ; // 删除整个表`

### order

- 我们通过order by xxx 让输出的顺序是按照某一个列进行排序的
- 默认是升序 asc
- 可以降序 desc
- ` select * from try where name in ('zi','hi') order by age desc;`
- ` select * from try where name in ('zi','hi') order by age asc;`
- 还可以进行嵌套使用
- `select * from try where name in ('zi','hi') order by age desc , name desc;`
- 代表如果age一样，则按照name的降序来

## dcl

## 常用字符类型

- 数值类型 ： int整形 long长整型 float单精度小数 double双精度 decimal小数，可以自己指定精度的
- 字符串 ： char字符（长度0-255 不足会自动补齐 补空格） varchar字符串（长度 0-65535 不会自己补空格）
- 日期 ：
- date 日期 ： YYYY-MM-DD
- time 时间 ： HH:mm:ss
- datetime : 年月日时分秒  YYYY-MM-DD  HH:mm:ss
- timesatmp ：和java里一样

# mysql的优化

- 避免使用select * 因为这会造成过多的资源浪费 ，  可以应用 where id = xx 筛选出要有需要的行
- 用union all 代替 union
- 用小表驱动大表 ： 简单来说 就是 判断条件用小表 ， 搜索用大表 ： 比如  ：in左大右小 ， exists左小右大
- 做增量操作 ： 比如 ：insert into 是可以一条语句插入多个数据的 但是最好不要超过500条
- 多用limit ：
- in中的值太多用limit限制
- 增量查询
- 高效的分页
- 用连接查询代替子查询
- join的加入不宜过多 ， 根据电脑来的 ，但是 一般是不超过3个
- 控制索引的数量 : 一般小于5个
- 选择合理的字段
- 提升gropu by 的效率
- 大数据一般用 hive 和 hbase
- 不要求 速度
- 但是可以presto等工具桥接
-
