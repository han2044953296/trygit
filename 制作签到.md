---
title: 签到的制作（后端＋前端）
date: 10/19/2022 1:22:28 PM 
categories: 签到的制作
comments: "true"
---

# 前提准备 #
- Centos7.8
- 在虚拟机安装好redis，并且可以成功ping通
- 使用jdk 11
- 使用idea 2019.3
- 准备好post man
- 准备好可以观察redis的软件，比如redisDespoketManger等
# 开始 #
- 先打开虚拟机，并开启redis
- 然后打开idea，创建springboot项目，在插件列表选择 
- spring web
- spring Data Redis
- Lombok
- 然后在pom文件里添加hutool插件（我们要用到的）
- 接下来修改application文件，我习惯把他的后缀改成yml
- 然后在application文件里添加
```
	spring:
	    redis:
	       # host: 192.168.1.121 #ip地址
	        host: 192.168.41.110
	        port: 6379 #端口
	        password: liuzihan #密码
	        timeout: 3000 #超时时间
	        database: 0 #第几号数据库
	server:
	    port: 9999 #这个是程序启动之后的端口号，也就是tomcat插件的端口号
```
- ip地址是虚拟机，或者局域网内真实机的ip
# 思考编写方式 #
- 我的编写思路是通过redis里的bitMap进行日期的存取
- 首先在SignDemoApplication的包内创建几个包，分别代表客户端，服务端以及自动启动还有配置文件包，
- 首先确定的是浏览器页面，原因很简单，网页有强大的动态效果，以及平台的适配能力，而且很美观，比较与传统的GUI要好不少
- 我的文件层级目录如下
- ![]([![x4XBBd.jpg](https://s1.ax1x.com/2022/10/29/x4XBBd.jpg)](https://imgse.com/i/x4XBBd))
## 配置文件 ##
- 创建config包，然后在包里创建RedisTemplateConfiguration.class
- 然后写入
```

		import com.fasterxml.jackson.annotation.JsonAutoDetect;
		import com.fasterxml.jackson.annotation.PropertyAccessor;
		import com.fasterxml.jackson.databind.ObjectMapper;
		import org.springframework.context.annotation.Bean;
		import org.springframework.context.annotation.Configuration;
		import org.springframework.data.redis.connection.RedisConnectionFactory;
		import org.springframework.data.redis.core.RedisTemplate;
		import org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;
		import org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;
		import org.springframework.data.redis.serializer.RedisSerializer;
		import org.springframework.data.redis.serializer.StringRedisSerializer;
		
		/**
		 * <p>ClassName: RedisConfigure</p >
		 * <p>Description: redisTemplate自定义序列化配置，更改其默认序列化器</p >
		 * <p>Date: 2021/10/23</p >
		 */
		@Configuration
		public class RedisTemplateConfiguration {
		
		    @Bean
		    public RedisTemplate<String,Object> redisTemplate(RedisConnectionFactory redisConnectionFactory){
		
		        RedisTemplate<String,Object> redisTemplate = new RedisTemplate<>();
		        // 参照StringRedisTemplate内部实现指定序列化器
		        redisTemplate.setConnectionFactory(redisConnectionFactory);
		        //使用 jackson2jasonRedisSerialize替换默认序列化
		        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class);
		        ObjectMapper objectMapper = new ObjectMapper();
		        objectMapper.setVisibility(PropertyAccessor.ALL , JsonAutoDetect.Visibility.ANY);
		        jackson2JsonRedisSerializer.setObjectMapper(objectMapper);
		        //为String类型 key/value 设置序列化
		        redisTemplate.setKeySerializer(new StringRedisSerializer());
		        redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);
		        //为hash ；类型 key、value 设置序列化
		        redisTemplate.setHashKeySerializer(new StringRedisSerializer());
		        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);
		        redisTemplate.afterPropertiesSet();
		        return redisTemplate;
		
		       /* redisTemplate.setKeySerializer(keySerializer());
		        redisTemplate.setHashKeySerializer(keySerializer());
		        redisTemplate.setValueSerializer(valueSerializer());
		        redisTemplate.setHashValueSerializer(valueSerializer());
		
		        return redisTemplate;*/
		    }
		
		    //使用Jackson序列化器，key使用字符串
		    private RedisSerializer<String> keySerializer() {
		        return new StringRedisSerializer();
		    }
		
		    //使用Jackson序列化器，value使用Object
		    private RedisSerializer<Object> valueSerializer() {
		        return new GenericJackson2JsonRedisSerializer();
		    }
		
		}

```
- 这个就是个简单的redis自动序列化类，网上一抓一大把
## 客户端 ##
- 客户端是我们主要想写的地方，就是实现签到，以及获取mac地址等功能的地方
- 于是我们创建Severdemo包
- 在这个包下，写入SignSeverce类写上
```
		
		import cn.hutool.core.date.DateUtil;
		import cn.hutool.core.date.LocalDateTimeUtil;
		import cn.hutool.core.net.NetUtil;
		import cn.hutool.core.util.StrUtil;
		import org.apache.ibatis.annotations.Mapper;
		
		
		import org.springframework.data.redis.connection.BitFieldSubCommands;
		import org.springframework.data.redis.core.RedisCallback;
		import org.springframework.data.redis.core.RedisTemplate;
		import org.springframework.stereotype.Service;
		
		import javax.annotation.Resource;
		import java.net.InetAddress;
		import java.net.UnknownHostException;
		import java.time.LocalDateTime;
		import java.util.*;
		
		@Service
		@Mapper
		public class SignService {
		
		    @Resource
		    private RedisTemplate redisTemplate;
		    /*
		     *用户签到可以补签
		     * @param UserId
		     * @param DataStr
		     * */
		    public Map<String , Object> doSign(String UserId , String DataStr){
		
		        InetAddress inetAddress = null;
		        try {
		            inetAddress = InetAddress.getLocalHost();
		        } catch (UnknownHostException e) {
		            e.printStackTrace();
		        }
		        //第二种方式：利用hutool工具类中的封装方法获取本机mac地址
		        String localMacAddress2 = NetUtil.getMacAddress(inetAddress);
		
		
		
		
		
		        Map<String , Object> result = new HashMap<>();
				
				// 判断MAc地址和redis中的是不是一样
		        if (String.valueOf(redisTemplate.keys("user:" + UserId + ":*")).equals("[]")){
		
		        } else {
		            String MAc = String.valueOf(redisTemplate.keys("user:" + UserId + ":*"));
		            String[] split = MAc.split(":");
		            if (localMacAddress2.equals(split[2])){
		
		            } else {
		                result.put("code" , 404);
		                result.put("message" , "你不是在同一台电脑上进行的签到，请联系管理员进行修复");
		                return  result;
		            }
		        }


				 // 获取日期
		        Date  date = getDate(DataStr);



				
				// 判断获取到了补签权限吗
		        if (DataStr != null){
            if (String.valueOf(redisTemplate.keys("user:" + UserId + ":*")).equals("[]")) {

            } else {
                String MAc = String.valueOf(redisTemplate.keys("user:" + UserId + ":*"));
                String[] split = MAc.split(":");
                if ("0".equals(split[3])) {
                    result.put("code", 407);
                    result.put("message", "你未经过老师同意无法补签");
                    return result;
                } else{

                    // 获取日期

                    // 获取日期对应的天数
                    int day = DateUtil.dayOfMonth(date) - 1;
                    // 构建redis 的 key
                    String signkey = buildSignKEy1(UserId,date , localMacAddress2);
                    // 查看日期是不是签到
                    boolean isSigned = redisTemplate.opsForValue().getBit(signkey , day);


                    if(isSigned){
                        result.put("code" , 400);
                        result.put("message" , "当前日期已完成签到，无需再签");
                        return  result;
                    }
                    // 签到
                    redisTemplate.opsForValue().setBit(signkey , day , true);
                    //根据当前日期获取签到的天数
                    Date today = new Date();
                    //统计总次数
                    long count = getSumSignCount(UserId , today);
                    //统计连续次数
                    int continuous = getContinusSignCount(UserId , today);

                    result.put("code" , 200);
                    result.put("message" , "签到成功");
                    result.put("continuous" , continuous);
                    result.put("count" , count);

                    String basicname = String.valueOf(redisTemplate.keys("user:" +UserId+ ":*"));
                    String changgename = basicname.substring(basicname.indexOf("[")+1 , basicname.indexOf("]"));
                    String[] namebasic  =  changgename.split(":");
                    String newname = namebasic[0] + ":" + namebasic[1] + ":" + namebasic[2] + ":0:" + namebasic[4];
                    redisTemplate.rename(changgename , newname);


                    return  result;
                }
            }
        }

	
		

		        // 获取日期对应的天数
		        int day = DateUtil.dayOfMonth(date) - 1;
		        // 构建redis 的 key
		        String signkey = buildSignKEy(UserId,date , localMacAddress2);
		        // 查看日期是不是签到
		        boolean isSigned = redisTemplate.opsForValue().getBit(signkey , day);
		
				// 判断今天是不是已经签到了
		        if(isSigned){
		            result.put("code" , 400);
		            result.put("message" , "当前日期已完成签到，无需再签");
		            return  result;
		        }
		        // 签到
		        redisTemplate.opsForValue().setBit(signkey , day , true);
		        //根据当前日期获取签到的天数
		        Date today = new Date();
		        //统计总次数
		        long count = getSumSignCount(UserId , today);
		        //统计连续次数
		        int continuous = getContinusSignCount(UserId , today);
		
		        result.put("code" , 200);
		        result.put("message" , "签到成功");
		        result.put("continuous" , continuous);
		        result.put("count" , count);
				
				// 更改补签权限
		        String basicname = String.valueOf(redisTemplate.keys("user:" +UserId+ ":*"));
		        String changgename = basicname.substring(basicname.indexOf("[")+1 , basicname.indexOf("]"));
		        String[] namebasic  =  changgename.split(":");
		        String newname = namebasic[0] + ":" + namebasic[1] + ":" + namebasic[2] + ":0:" + namebasic[4];
		        redisTemplate.rename(changgename , newname);
		
		
		        return  result;
		    }
		













			// 获取用户当天签到的情况
		    public Map<String , Object>getSignByDate(String UserId , String DataStr){
		
		        InetAddress inetAddress = null;
		        try {
		            inetAddress = InetAddress.getLocalHost();
		        } catch (UnknownHostException e) {
		            e.printStackTrace();
		        }
		        //第二种方式：利用hutool工具类中的封装方法获取本机mac地址
		        String localMacAddress2 = NetUtil.getMacAddress(inetAddress);
		        System.out.println("localMacAddress2 = " + localMacAddress2);
		
		
		        Map<String , Object> result = new HashMap<>();
		
		
		        if (String.valueOf(redisTemplate.keys("user:" + UserId + ":*")).equals("[]")){
		
		        } else {
		            String MAc = String.valueOf(redisTemplate.keys("user:" + UserId + ":*"));
		            String[] split = MAc.split(":");
		            if (localMacAddress2.equals(split[2])){
		                System.out.println(split[2]);
		            } else {
		                result.put("code" , 404);
		                result.put("message" , "你不是在同一台电脑上进行的签到，请联系管理员进行修复");
		                return  result;
		            }
		        }
		
		       
		        Date date = getDate(DataStr);
		        // 获取日期对应的天数
		        int day = DateUtil.dayOfMonth(date) - 1;
		        // 构建redis 的 key
		        String signkey = buildSignKEy(UserId, date , localMacAddress2);
		        // 查看日期是不是签到
		        boolean isSigned = redisTemplate.opsForValue().getBit(signkey , day);
		
		        // 签到
		
		        //根据当前日期获取签到的天数
		        Date today = new Date();
		        //统计总次数
		        long count = getSumSignCount(UserId , today);
		        //统计连续次数
		        int continuous = getContinusSignCount(UserId , today);
		        result.put("today" , isSigned);
		
		        result.put("continuous" , continuous);
		        result.put("count" , count);
		        return  result;
		    }





			// 获取签到天数的信息
		    public Map<String , Object> getSignInfo(String UserId , String DataStr){
		
		        InetAddress inetAddress = null;
		        try {
		            inetAddress = InetAddress.getLocalHost();
		        } catch (UnknownHostException e) {
		            e.printStackTrace();
		        }
		        //第二种方式：利用hutool工具类中的封装方法获取本机mac地址
		        String localMacAddress2 = NetUtil.getMacAddress(inetAddress);
		        System.out.println("localMacAddress2 = " + localMacAddress2);
		
		
		        Date date = getDate(DataStr);
		        String signkey = buildSignKEy(UserId , date , localMacAddress2);
		        // 构建一个归自动排序的Map
		        Map<String , Object> signInfo = new TreeMap<>();
		        // 获取一个月的总天数
		        int dayOfMouth = DateUtil.lengthOfMonth(DateUtil.month(date) + 1 , DateUtil.isLeapYear(DateUtil.dayOfYear(date)));
		
		        // bitfiled user : sign : 5 : 2021 014 u30
		        BitFieldSubCommands bitFieldSubCommands = BitFieldSubCommands.create().get(BitFieldSubCommands.BitFieldType.unsigned(dayOfMouth)).valueAt(0);
		
		        // 获取用户从该当前日期到1号的状态
		        List<Long> list = redisTemplate.opsForValue().bitField(signkey , bitFieldSubCommands);
		        if (list == null || list.isEmpty()){
		            return  signInfo;
		        }
		
		        long v = list.get(0) == null ? 0 :list.get(0);
		        for (int i = dayOfMouth ; i > 0 ; i--){
		            /**
		             *  map的存储格式
		             *      签到：  yyyy-mm-01
		             *      未签到  yyyy-mm-02 不做任何处理
		             *
		             */
		
		            // 获取日期
		         LocalDateTime localDateTime =  LocalDateTimeUtil.of(date).withDayOfMonth(i);
		            // 右移再左移
		            boolean flag = v >> 1 << 1 !=v;
		            if (flag){
		                signInfo.put(DateUtil.format(localDateTime , "yyyy-MM-dd") , "✔");
		            }
		            v >>= 1 ;
		        }
		
		        return signInfo;
		    }
		





			// 获取签到天数的总和
		    private long getSumSignCount(String userId, Date today) {
		
		        InetAddress inetAddress = null;
		        try {
		            inetAddress = InetAddress.getLocalHost();
		        } catch (UnknownHostException e) {
		            e.printStackTrace();
		        }
		        //第二种方式：利用hutool工具类中的封装方法获取本机mac地址
		        String localMacAddress2 = NetUtil.getMacAddress(inetAddress);
		        System.out.println("localMacAddress2 = " + localMacAddress2);
		
		
		        String signkey = buildSignKEy(userId , today , localMacAddress2);
		        //bitcount命令
		        return(long) redisTemplate.execute((RedisCallback<Long>)con -> con.bitCount(signkey.getBytes()));
		    }
		
		
			// 获取连续签到天数
		    private int getContinusSignCount(String userId, Date today) {
		
		        InetAddress inetAddress = null;
		        try {
		            inetAddress = InetAddress.getLocalHost();
		        } catch (UnknownHostException e) {
		            e.printStackTrace();
		        }
		        //第二种方式：利用hutool工具类中的封装方法获取本机mac地址
		        String localMacAddress2 = NetUtil.getMacAddress(inetAddress);
		        System.out.println("localMacAddress2 = " + localMacAddress2);
		
		        // 获取日期对应的天数
		        int dayofMonth = DateUtil.dayOfMonth(today);
		        String signkey = buildSignKEy(userId , today , localMacAddress2);
		
		        BitFieldSubCommands bitFieldSubCommands = BitFieldSubCommands.create().get(BitFieldSubCommands.BitFieldType.unsigned(dayofMonth)).valueAt(0);
		
		        // 获取用户从该当前日期到1号的状态
		        List<Long> list = redisTemplate.opsForValue().bitField(signkey , bitFieldSubCommands);
		        if (list == null || list.isEmpty()){
		            return  0;
		        }
		        int Signcount = 0;
		        long v = list.get(0) == null ? 0 :list.get(0);
		        for (int i = dayofMonth ; i > 0 ; i--){
		            // i表示位移操作的次数
		            if(v >> 1 << 1 == v) {
		                // 用户当前可能未签到，所以要排除当天的可能性
		                if(i != dayofMonth) {
		                    break;
		                }
		            } else {
		                // 如果右移后又左移和自己不相等 代表她已经签到
		                Signcount++;
		            }
		            // 右移一位并重新赋值，相当于丢弃已经判断的数字
		            v >>= 1 ;
		        }
		        return Signcount;
		    }
		

			// redis里存储的key方法
		    private String buildSignKEy(String userId, Date date , String localMacAddress) {
		        return  String.format("user:%s:%s:0:%s",userId ,localMacAddress, DateUtil.format(date, "yyyyMM"));
		    }
		
			// 判断是不是补签
		    private Date getDate(String dataStr) {
		        return StrUtil.isBlank(dataStr) ? new Date() : DateUtil.parseDate(dataStr);
		    }
		
		
			// 教师查看端
		    public List<Object> teachercck(String DataStr) {
		
		
		        Map<Object , Object> result = new HashMap();
		        List<Object> end = new ArrayList<>();
		        String basicname = String.valueOf(redisTemplate.keys("user:" + "*"));
		        String[] basic = basicname.split(",");
		        Date date = getDate(DataStr);
		        int day = DateUtil.dayOfMonth(date) - 1;
		//        end.put("code" , 0);
		//        end.put("msg" , "");
		//        result.put("count" , basic.length);
		        end.add(basic.length);
		        for( int i = 0 ; i < basic.length ; i++ ){
		                String[] namebasic  =  basic[i].split(":");
		                String signkey = buildSignKEy(namebasic[1], date , namebasic[2]);
		                boolean isSigned = redisTemplate.opsForValue().getBit(signkey , day);
		//                result.put(i+1 , namebasic[1]);
		                end.add(namebasic[1]);
		                end.add(namebasic[2]);
		//                result.put(namebasic[1], namebasic[2]);
		                if (isSigned){
		//                    result.put(namebasic[2] , "今日已经签到");
		                    end.add("今日已经签到");
		                } else {
		//                    result.put(namebasic[2] , "今日没有签到");
		                    end.add("今日未签到");
		                }
		                if (namebasic[3].equals("0")){
		                    end.add("未获得补签权限");
		                } else {
		                    end.add("已经获得补签权限");
		                }
		        }
		
		        return end;
		    }
		
		

			// 教师更改学生可以补签的权限
		    public Map<Object , Object> teacherchange(String UserId)
		    {
		        Map<Object , Object> result = new HashMap();
		        String basicname = String.valueOf(redisTemplate.keys("user:" +UserId+ ":*"));
		        String changgename = basicname.substring(basicname.indexOf("[")+1 , basicname.indexOf("]"));
		        String[] namebasic  =  changgename.split(":");
		
		        String newname = namebasic[0] + ":" + namebasic[1] + ":" + namebasic[2] + ":1:" + namebasic[4];
		        redisTemplate.rename(changgename , newname);
		
		        result.put("code" , 404);
		        result.put("message" , "成功修改");
		        return  result;
		
		    }
		
		
		}
		

```
## 控制端 ##

```

		package com.example.demo.controller;
		
		import com.example.demo.Servicedemo.SignService;
		import org.springframework.web.bind.annotation.GetMapping;
		import org.springframework.web.bind.annotation.PostMapping;
		import org.springframework.web.bind.annotation.RequestMapping;
		import org.springframework.web.bind.annotation.RestController;
		
		
		import javax.annotation.Resource;
		import java.util.Map;
		
		
		@RestController
		
		@RequestMapping("sign")
		public class SignController {
		    @Resource
		    private SignService signservice;
		
		    /*
		     * 用户的签到可以补签
		     * */
		    @PostMapping
		    public Map<String  , Object> doSignIn(String UserId , String DataStr){
		
		        return signservice.doSign(UserId , DataStr);
		    }
		
		    // 获取用户当天的签到情况
		    @GetMapping("today")
		    public Map<String  , Object> getSignByDate(String UserId , String DataStr){
		
		        return signservice.getSignByDate(UserId , DataStr);
		    }
		
		    @PostMapping("SIGNFO")
		    public  Map<String , Object> GetSignInfo(String UserId , String DataStr){
		
		        return  signservice.getSignInfo(UserId , DataStr);
		
		    }
		    @PostMapping("/teacher")
		    public java.util.List<Object> Getinfo(String DataStr){
		
		        return signservice.teachercck(DataStr);
		    }
		
		    @PostMapping("/change")
		    public Map<Object, Object> chenge(String USerId){
		
		        return signservice.teacherchange(USerId);
		    }
		
		}

```

## 自动启动浏览器 ##
- 先在SignDemo的同级目录下创建web启动类
- 如下

```

		package com.example.demo;
		
		import org.springframework.web.bind.annotation.GetMapping;
		import org.springframework.web.bind.annotation.RestController;
		
		@RestController
		public class ControllerTest {
		    @GetMapping
		    public String run() {
		
		        return "启动springboot成功!";
		
		    }
		
		}
```

- 然后在与SignDEmo同级的包里创建一个浏览器自动启动类

```


		package com.example.demo.AutoB;
		
		
		import org.springframework.boot.context.event.ApplicationReadyEvent;
		import org.springframework.context.annotation.Configuration;
		import org.springframework.context.event.EventListener;
		
		import java.io.IOException;
		
		@Configuration
		public class AutoBrower {
		    @EventListener({ApplicationReadyEvent.class})
		    void applicationReadyEvent() {
		        System.out.println("应用已经准备就绪 ... 启动浏览器");
		        // 这里需要注url:端口号+测试类方法名
		        String url = "http://localhost:9999/index.html";
		        Runtime runtime = Runtime.getRuntime();
		        try {
		            runtime.exec("rundll32 url.dll,FileProtocolHandler " + url);
		        } catch (IOException e) {
		            e.printStackTrace();
		        }
		    }
		
		}
```

- 上面那个url是我们要自动启动的网页
# 前端浏览器页面 #
- 前端浏览器页面我们主要使用ajax进行浏览器的传值，
- 前端我们使用了嵌套的布局，是一个index嵌套一个welcome
- 代码如下

```

		<!DOCTYPE html>
		<html>
		<head>
		    <meta charset="utf-8">
		    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		    <title>个人中心</title>
		    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/layui/2.7.6/css/layui.css">
		</head>
		<body>
		<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
		    <legend>个人中心</legend>
		</fieldset>
		
		<div style="padding: 20px">
		<div class = "layui-col-md3">
		<div class="layui-tab layui-tab-card">
		    <ul class="layui-tab-title">
		        <li class="layui-this">签到</li>
		        <li>补签</li>
		        <li id="">记录</li>
		
		    </ul>
		    <div class="layui-tab-content" style="height: 100px;">
		        <div class="layui-tab-item layui-show">
		
		            <div class="layui-form-item">
		                <button class="layui-btn layui-btn-radius layui-btn-normal layui-form-label" id = "SignBtn" style="margin-left: 20px" > 签 &nbsp 到</button>
		                <div class="layui-input-block">
		                    <input type="text" name="username" lay-verify="title" autocomplete="off" placeholder="请输入姓名" class="layui-input" id="user">
		                </div>
		            </div>
		            <hr>
		            <p>你已签到&nbsp;<span style = "color: red;" id="count" >0 </span>&nbsp;天</p>
		            <p>连续签到&nbsp;<span style = "color: red;" id="continuous">0</span>&nbsp;天</p>
		        </div>
		
		        <div class="layui-tab-item">
		            <div class="layui-inline">
		                <input type="text" class="layui-input" id="reissue" placeholder="请选择日期">
		            </div>
		            <button class="layui-btn layui-btn-radius layui-btn-normal" id = "reissueBtn"> 补签</button>
		            <div class="layui-form-item">
		                    <input type="text" name="username" lay-verify="title" autocomplete="off" placeholder="请输入姓名" class="layui-input" id="user1">
		
		            </div>
		        </div>
		        <div class="layui-tab-item">
		
		            <div class="layui-form-item">
		                <button class="layui-btn layui-btn-radius layui-btn-normal layui-form-label" id = "recordLi">查询记录</button>
		                <div class="layui-input-block">
		                    <input type="text" name="username" lay-verify="title" autocomplete="off" placeholder="请输入姓名" class="layui-input" id="user2">
		                </div>
		            </div>
		
		            <div class="layui-inline" id="record">
		
		            </div>
		        </div>
		
		    </div>
		    </div>
		</div>
		</div>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/element-ui/2.15.10/index.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/layui/2.7.6/layui.js"></script>
		<script>
		
		
		
		
		
		
		
		    // $(function () {
		    //
		    //     var value = jQuery("#user").val();
		    //
		    //     $.ajax({
		    //         url: "/sign/today",
		    //         type: "GET",
		    //         data: {"UserId" : value}, // 模拟的用户id
		    //         dataType: "JSON",
		    //         success: function f(result) {
		    //             layer.msg(result.message);
		    //             if(200 == result.code){
		    //                 if (true == result.today) {
		    //                     $("#count").text(result.count);
		    //                     // 设置连续签到次数
		    //                     $("#continuous").text(result.continuous);
		    //                     // 设置签到按钮的文本
		    //                     $("#SignBtn").text("已经签到");
		    //                     // 禁用签到按钮
		    //                     $("#SignBtn").addClass("layui-btn-disabled");
		    //                     $("#SignBtn").attr("disabled" , "true");
		    //                 }
		    //
		    //             }
		    //
		    //
		    //         }
		    //
		    //     });
		    //
		    // })
		
		    layui.use('laydate', function(){
		        var laydate = layui.laydate;
		
		        //执行一个laydate实例
		        laydate.render({
		            elem: '#reissue' //指定元素
		        });
		    });
		    layui.use('layer' , function () {
		        // 签到
		        $("#SignBtn").on("click", function () {
		            var value = jQuery("#user").val();
		            $.ajax({
		                url: "/sign",
		                type: "POST",
		                data: {"UserId": value}, // 模拟的用户id
		                dataType: "JSON",
		                success: function f(result) {
		                    // for (var m in result){
		                    //     alert(m)
		                    //     alert(result[m])
		                    // }
		                    layer.msg(result.message);
		                    if (200 == result.code) {
		                        // 设置总签到次数
		                        $("#count").text(result.count);
		                        // 设置连续签到次数
		                        $("#continuous").text(result.continuous);
		                        // 设置签到按钮的文本
		                        $("#SignBtn").text("已经签到");
		                        // 禁用签到按钮
		                        $("#SignBtn").addClass("layui-btn-disabled");
		                        $("#SignBtn").attr("disabled", "true");
		                    }
		
		
		                }
		
		            });
		        })
		
		        //补签
		        $("#reissueBtn").on("click" , function () {
		            var va = jQuery("#user1").val();
		
		            $.ajax({
		                url: "/sign",
		                type: "POST",
		                data: {"UserId" : va , "DataStr" : $("#reissue").val()}, // 模拟的用户id
		                dataType: "JSON",
		                success: function f(result) {
		                    layer.msg(result.message);
		                    if(200 == result.code){
		                        // 设置总签到次数
		                        $("#count").text(result.count);
		
		                        // 设置连续签到次数
		                        $("#continuous").text(result.continuous);
		
		                    }
		
		
		                }
		
		            });
		        })
		
		
		    })
		
		
		
		    // 签到记录的元素
		    $("#recordLi").on("click" , function () {
		        var vae = jQuery("#user2").val();
		        layui.use('layer' , function () {
		            var laydate = layui.laydate;
		
		            // 获取签到记录
		            $.ajax({
		                url: "/sign/SIGNFO",
		                type: "POST",
		                data: {"UserId": vae}, // 模拟的用户id
		                dataType: "JSON",
		                success: function f(result) {
		
		                    // 清空日历元素
		                    $("#record").html("");
		
		                    laydate.render({
		                        elem: '#record'
		                        ,mark: result,
		                        position: 'static'
		                    })
		
		                }
		
		            });
		
		
		        })
		    });
		
		</script>
		</body>
		</html>

```

- index的

```



		<!DOCTYPE html>
		<html>
		<head>
		    <meta charset="utf-8">
		    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		    <title>用户签到系统</title>
		    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/layui/2.7.6/css/layui.css" media="all">
		</head>
		<body>
		<div class="layui-layout layui-layout-admin">
		    <div class="layui-header">
		        <div class="layui-logo layui-hide-xs layui-bg-black">用户签到系统</div>
		        <!-- 头部区域（可配合layui 已有的水平导航） -->
		        <ul class="layui-nav layui-layout-left">
		            <!-- 移动端显示 -->
		            <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-header-event="menuLeft">
		                <i class="layui-icon layui-icon-spread-left"></i>
		            </li>
		
		            <li class="layui-nav-item layui-hide-xs"><a href="">签到</a></li>
		
		        </ul>
		    </div>
		
		    <div class="layui-side layui-bg-black">
		        <div class="layui-side-scroll">
		            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
		
		            </ul>
		        </div>
		    </div>
		
		    <div class="layui-body">
		        <!-- 内容主体区域 -->
		        <iframe src="welcome.html"  name="container" style="width: 100%; height: 100%; "></iframe>
		    </div>
		
		    <div class="layui-footer">
		        <!-- 底部固定区域 -->
		        底部固定区域
		    </div>
		</div>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/layui/2.7.6/layui.js"></script>
		<script>
		
		</script>
		</body>
		</html>

```
- 上述只是学生端的，对于教师端也和其大差不差，代码如下

```

		<!DOCTYPE html>
		<html>
		<head>
		    <meta charset="utf-8">
		    <title>Layui</title>
		    <meta name="renderer" content="webkit">
		    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/layui/2.7.6/css/layui.css"    media="all">
		    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
		</head>
		<body>
		
		<legend>教师中心</legend>
		</fieldset>
		
		<div class="layui-tab layui-tab-card">
		    <ul class="layui-tab-title">
		        <li class="layui-this">查看签到情况</li>
		        <li>更改权限</li>
		    </ul>
		    <div class="layui-tab-content" style="height: 100px;">
		        <div class="layui-tab-item layui-show">
		            <table border="1" width="600px">
		            <tbody >
		            <tr  style='width:300px' >
		                <td>姓名</td>
		                <td>Mac地址</td>
		                <td>今日签到情况</td>
		                <td>补签情况</td>
		            </tr>
		            </tbody>
		            <tbody id="tbody1">
		            </tbody>
		        </table></div>
		        <div class="layui-tab-item">
		
		            <button class="layui-btn layui-btn-radius layui-btn-normal" id = "reissueBtn">更改补签权限</button>
		            <div class="layui-form-item">
		                <input type="text" name="username" lay-verify="title" autocomplete="off" placeholder="请输入姓名" class="layui-input" id="user1">
		
		            </div>
		
		
		        </div>
		    </div>
		</div>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/layui/2.7.6/layui.js" charset="utf-8"></script>
		<!-- 注意：如果你直接复制所有代码到本地，上述 JS 路径需要改成你本地的 -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/element-ui/2.15.10/index.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/layui/2.7.6/layui.js"></script>
		
		
		
		<script>
		
		        $.ajax({
		            url: "/sign/teacher",
		            type: "POST",
		            data: {"DataStr": null},
		            dataType: "JSON",
		            success: function f(result) {
		                var m = 0;
		                var tableData = null;
		                for (let k = 1; k <= result[0]; k++) {
		
		                    tableData += "<tr  style='width:300px' >"
		                    for (let i = 1 + m; i <= 4 + m; i++) {
		                        tableData += "<td>" + result[i] + "</td>"
		
		                    }
		                    // tableData += "<td><button type='submit' onclick='btnAction' name='btn'>更改补签权限</button></td>"
		                    tableData += "</tr>"
		                    m += 4;
		                }
		                $("#tbody1").html(tableData)
		            }
		    });
		
		
		     $("#reissueBtn").on("click" , function () {
		         var va = jQuery("#user1").val();
		                alert(va)
		         $.ajax({
		             url: "/sign/change",
		             type: "POST",
		             data: {"USerId" : va},
		             dataType: "JSON",
		             success: function f(result) {
		                 layer.msg(result.message);
		
		             }
		
		         });
		     })
		
		
		
		</script>
		
		</body>
		</html>
```

- 教师的index

```

		<!DOCTYPE html>
		<html>
		<head>
		    <meta charset="utf-8">
		    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		    <title>教师观察系统</title>
		    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/layui/2.7.6/css/layui.css" media="all">
		</head>
		<body>
		<div class="layui-layout layui-layout-admin">
		    <div class="layui-header">
		        <div class="layui-logo layui-hide-xs layui-bg-black">教师观察系统</div>
		        <!-- 头部区域（可配合layui 已有的水平导航） -->
		        <ul class="layui-nav layui-layout-left">
		            <!-- 移动端显示 -->
		            <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-header-event="menuLeft">
		                <i class="layui-icon layui-icon-spread-left"></i>
		            </li>
		
		            <li class="layui-nav-item layui-hide-xs"><a href="">签到情况</a></li>
		
		        </ul>
		    </div>
		
		    <div class="layui-side layui-bg-black">
		        <div class="layui-side-scroll">
		            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
		
		            </ul>
		        </div>
		    </div>
		
		    <div class="layui-body">
		        <!-- 内容主体区域 -->
		        <iframe src="teacher.html"  name="container" style="width: 100%; height: 100%; "></iframe>
		    </div>
		
		    <div class="layui-footer">
		        <!-- 底部固定区域 -->
		        底部固定区域
		    </div>
		</div>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/layui/2.7.6/layui.js"></script>
		<script>
		
		</script>
		</body>
		</html>
		

```